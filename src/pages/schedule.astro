---
import BaseLayout from '../layouts/BaseLayout.astro';
import Notice from '../components/Notice.astro';

const base = import.meta.env.BASE_URL;
const config = await import('../../data/config.json');
const seasonSchedule = await import('../../data/season-schedule.json');
const currentWeek = await import('../../data/current-week.json');

// Helper function to determine home/away status and get correct opponent
function getMatchInfo(match) {
  // If QPR is the home team, then it's a home match for us
  const isQPRHome = match.home_team.includes('Queens Park Rangers') || match.home_team.includes('QPR');
  const isHome = isQPRHome;
  
  // Get the opponent (the team that's not QPR)
  const opponent = isQPRHome ? match.away_team : match.home_team;
  
  return {
    isHome,
    opponent,
    icon: isHome ? 'üè†' : '‚úàÔ∏è',
    text: isHome ? 'Home' : 'Away',
    // Prefer specific field name if available; fall back to generic venue label
    venue: match.field || match.venue || (isHome ? 'Home TBA' : 'Away TBA')
  };
}
---

<BaseLayout title="Schedule - Queens Park Rangers U11B" description="Full season schedule for QPR U11B including practice times, game fixtures, and results. Thursday practices and Saturday matches.">
  <div class="container">
    <header style="text-align: center; margin-bottom: var(--spacing-2xl);">
      <h1>‚öΩ Practice & Game Schedule üèÜ</h1>
      <p>Regular practice times and upcoming fixtures for the 2025-2026 season.</p>
    </header>

    <div class="grid grid-2">
      <!-- Practice Schedule -->
      <div>
        <h2 class="soccer-icon">Practice Schedule</h2>
        <div class="card card-highlight team-highlight">
          <h3>üèÉ‚Äç‚ôÇÔ∏è Weekly Practice</h3>
          <div style="font-size: var(--font-size-lg); margin: var(--spacing-md) 0;">
            <p><strong>Thursdays</strong></p>
            <p><strong>5:00 PM - 6:00 PM</strong></p>
            <p><strong>Mobilio West (Town Centre Park) - Grid D</strong></p>
          </div>
          <Notice type="info">
            <p><strong>Coach:</strong> Nagy Elshal<br>
            <strong>Team Level:</strong> U11B<br>
            <strong>Arrive:</strong> 10 minutes early for warm-up</p>
          </Notice>
        </div>

        <!-- Next Training Session -->
        <div class="card" style="margin-top: var(--spacing-lg);">
          <h4>üìÖ Next Training Session</h4>
          <div style="padding: var(--spacing-md); background: rgba(25, 118, 210, 0.05); border-radius: var(--radius); margin: var(--spacing-md) 0;">
            <p style="margin: 0; font-size: 1.1rem;">
              <strong>{currentWeek.default.training.day}, {new Date(currentWeek.default.training.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</strong><br>
              <span style="color: var(--color-text-light);">{currentWeek.default.training.time} at {currentWeek.default.training.location}</span>
            </p>
            {currentWeek.default.training.focus && (
              <p style="margin-top: var(--spacing-sm); font-size: 0.9rem; color: var(--color-text-light);">
                <em>Focus: {currentWeek.default.training.focus}</em>
              </p>
            )}
          </div>
          <p style="color: var(--color-text-light); font-size: var(--font-size-sm); margin-top: var(--spacing-md);">
            <em>Training schedule may be adjusted due to weather. Check <a href={`${base}current-week/`}>This Week</a> for the latest updates.</em>
          </p>
        </div>
      </div>

      <!-- Game Schedule -->
      <div>
        <h2 class="soccer-icon">Game Schedule</h2>
        <div class="card game-card">
          <h3>üèÜ NFYSA Boys U11 DIV 3</h3>
          <p><strong>Season:</strong> Fall/Winter 2025<br>
          <strong>Game Day:</strong> Saturdays<br>
          <strong>First Game:</strong> September 6, 2025</p>
          
          <Notice type="success" title="Fixtures Confirmed">
            <p>Our game schedule is posted by NFYSA. Kickoff times and field locations for the first weeks are confirmed below.</p>
          </Notice>
        </div>
      </div>
    </div>

    <!-- Full Width Season Fixtures -->
    <section style="margin-top: var(--spacing-2xl);">
      <h2 class="soccer-icon">‚öΩ Season Fixtures</h2>
      <div class="card fixtures-card">
        <div class="table-responsive fixtures-table-container">
          <table class="table fixtures-table">
            <thead>
              <tr>
                <th class="week-col">Week</th>
                <th class="date-col">Date</th>
                <th class="opponent-col">Opponent</th>
                <th class="venue-col">Venue</th>
                <th class="status-col">Status</th>
              </tr>
            </thead>
            <tbody>
              {seasonSchedule.matches.map(match => {
                const matchInfo = getMatchInfo(match);
                return (
                <tr class={match.status === 'scheduled' && new Date(match.date) >= new Date() ? 'next-game' : ''}>
                  <td class="week-col">{match.week}</td>
                  <td class="date-col">{match.date === 'TBD' ? 'TBD' : new Date(match.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</td>
                  <td class="opponent-col">
                    <div class="opponent-info">
                      <span class={`venue-badge ${matchInfo.isHome ? 'home' : 'away'}`}>
                        <span class="venue-icon">{matchInfo.icon}</span>
                        <span class="venue-text">{matchInfo.text}</span>
                      </span>
                      <span class="opponent-name">{matchInfo.opponent}</span>
                    </div>
                  </td>
                  <td class="venue-col">
                    <span class="venue-location">{matchInfo.venue}</span>
                  </td>
                  <td class="status-col">
                    {match.status === 'completed' && match.result ? (
                      <span class={`status-result ${match.result.toLowerCase().includes('win') ? 'win' : match.result.toLowerCase().includes('draw') ? 'draw' : 'loss'}`}>
                        {match.result}
                      </span>
                    ) : match.status === 'cancelled' ? (
                      <span class="status-cancelled">Cancelled</span>
                    ) : (
                      <span class="status-scheduled">üìÖ {match.kickoff || 'TBA'}</span>
                    )}
                  </td>
                </tr>
                );
              })}
            </tbody>
          </table>
        </div>
        <div style="margin-top: var(--spacing-md);">
          <Notice type="info">
            <p><strong>First 5 Weeks:</strong> {seasonSchedule.season_summary.total_matches} games scheduled ‚Ä¢ {seasonSchedule.season_summary.home_matches} home ‚Ä¢ {seasonSchedule.season_summary.away_matches} away<br>
            <strong>Match Times:</strong> All kickoff times TBA by league<br>
            <strong>Note:</strong> Additional fixtures will be added as the season schedule is released</p>
          </Notice>
        </div>
      </div>
    </section>

    <!-- Season Calendar -->
    <section style="margin-top: var(--spacing-2xl);">
      <h2 class="soccer-icon">üìÖ Season Calendar 2025-2026</h2>
      <div class="grid grid-2">
        <div class="card card-highlight">
          <h3>üçÇ Fall 2025</h3>
          <ul style="line-height: 1.8;">
            <li><strong>üìÖ Season Start:</strong> Thursday, Sept 4 (First Practice)</li>
            <li><strong>‚öΩ First Game:</strong> Saturday, Sept 6</li>
            <li><strong>ü¶É No Practice/Games:</strong> Thanksgiving Oct 9 & 16</li>
            <li><strong>üìÖ Last Practice 2025:</strong> Thursday, Dec 12</li>
            <li><strong>‚öΩ Last Game 2025:</strong> Saturday, Dec 7</li>
          </ul>
        </div>
        
        <div class="card card-highlight">
          <h3>‚ùÑÔ∏è Winter Break & Spring 2026</h3>
          <ul style="line-height: 1.8;">
            <li><strong>‚ùÑÔ∏è Winter Break:</strong> Dec 15 ‚Äì Jan 4</li>
            <li><strong>üìÖ Practice Resumes:</strong> Thursday, Jan 8</li>
            <li><strong>‚öΩ Games Resume:</strong> Saturday, Jan 11</li>
            <li><strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ No Practice/Games:</strong> Family Day Feb 12</li>
            <li><strong>üèÅ Season Ends:</strong> Late February 2026</li>
          </ul>
        </div>
      </div>
      
      <Notice type="info" title="Season Overview">
        <p>The 2025-2026 season runs from September through February with a winter break over the holidays. Practice and game schedules may be adjusted due to weather or field availability.</p>
      </Notice>
    </section>

    <!-- Important Reminders -->
    <section style="margin-top: var(--spacing-2xl);">
      <h2>Important Reminders</h2>
      <div class="grid grid-2">
        <Notice type="info" title="Practice Attendance">
          <p>Please arrive 10 minutes early for warmup. Bring water bottle, shin guards, and appropriate footwear.</p>
        </Notice>
        
        <Notice type="success" title="Weather Updates">
          <p>Check team news for any weather-related practice cancellations. Updates will be posted by 3 PM on practice days.</p>
        </Notice>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .fixtures-card {
    padding: var(--spacing-xl);
  }
  
  .fixtures-table-container {
    overflow-x: auto;
  }
  
  .fixtures-table {
    font-size: 1rem;
    width: 100%;
    table-layout: fixed;
  }
  
  .fixtures-table .week-col {
    width: 8%;
  }
  
  .fixtures-table .date-col {
    width: 12%;
  }
  
  .fixtures-table .opponent-col {
    width: 50%;
  }
  
  .fixtures-table .venue-col {
    width: 15%;
  }
  
  .fixtures-table .status-col {
    width: 15%;
  }
  
  .fixtures-table th {
    padding: var(--spacing-md) var(--spacing-lg);
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--color-primary);
    background: rgba(25, 118, 210, 0.05);
    white-space: nowrap;
  }
  
  .fixtures-table td {
    padding: var(--spacing-lg);
    vertical-align: middle;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    font-size: 1rem;
    line-height: 1.5;
  }
  
  .opponent-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-xs);
  }
  
  .venue-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .venue-badge.home {
    background: linear-gradient(135deg, #00a651 0%, #00d064 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(0, 166, 81, 0.3);
  }

  .venue-badge.away {
    background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(21, 101, 192, 0.3);
  }

  .venue-icon {
    font-size: 1em;
  }
  
  .opponent-name {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--color-text);
  }

  .venue-location {
    font-size: 0.9rem;
    color: var(--color-text-light);
  }
  
  .fixtures-table tbody tr {
    transition: all 0.2s ease;
  }
  
  .fixtures-table tbody tr:hover {
    background-color: rgba(25, 118, 210, 0.03);
    transform: translateX(2px);
  }

  .next-game {
    background-color: rgba(25, 118, 210, 0.08);
    border-left: 4px solid var(--color-primary);
  }
  
  .next-game td {
    font-weight: 600;
  }
  
  .venue-home {
    background: rgba(76, 175, 80, 0.2);
    color: #2e7d32;
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-block;
    min-width: 60px;
    text-align: center;
    white-space: nowrap;
  }
  
  .venue-away {
    background: rgba(255, 152, 0, 0.2);
    color: #ef6c00;
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-block;
    min-width: 60px;
    text-align: center;
    white-space: nowrap;
  }
  
  .status-scheduled {
    background: rgba(25, 118, 210, 0.1);
    color: var(--color-primary);
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.9rem;
    display: inline-block;
    white-space: nowrap;
  }

  .status-result {
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.85rem;
    display: inline-block;
    white-space: nowrap;
  }

  .status-result.win {
    background: rgba(76, 175, 80, 0.2);
    color: #2e7d32;
  }

  .status-result.draw {
    background: rgba(156, 39, 176, 0.15);
    color: #7b1fa2;
  }

  .status-result.loss {
    background: rgba(244, 67, 54, 0.15);
    color: #c62828;
  }

  .status-cancelled {
    background: rgba(158, 158, 158, 0.2);
    color: #616161;
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.85rem;
    display: inline-block;
    white-space: nowrap;
  }
  
  .game-card {
    border-left: 4px solid var(--color-primary);
  }
  
  @media (max-width: 768px) {
    .fixtures-card {
      padding: var(--spacing-lg);
    }
    
    .fixtures-table-container {
      margin: 0 -var(--spacing-md);
      padding: 0 var(--spacing-md);
    }
    
    .fixtures-table {
      min-width: 600px;
    }
    
    .fixtures-table th,
    .fixtures-table td {
      padding: var(--spacing-md);
      font-size: 0.9rem;
    }
    
    .venue-home,
    .venue-away,
    .status-scheduled {
      padding: 4px 8px;
      font-size: 0.8rem;
      min-width: 50px;
    }
    
    .opponent-name {
      font-size: 0.9rem;
    }
  }
</style>
